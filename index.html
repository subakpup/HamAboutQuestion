<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¸ì œ í•¨ ì–´ë•Œ</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .question-container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .question-title { font-size: 1.5em; color: #333; margin-bottom: 10px; }
        .question-img { max-width: 100%; height: auto; display: block; margin-top: 15px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .answer-input { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; }
        .answer-options { display: flex; flex-direction: column; gap: 10px; }
        .answer-options label { background: #eee; padding: 10px; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
        .answer-options label:hover { background: #ddd; }
        .button-group { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .button-row { display: flex; gap: 10px; }
        .button-group button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        #submit-btn { background-color: #007BFF; color: white; }
        #submit-btn:hover { background-color: #0056b3; }
        #next-btn { background-color: #28a745; color: white; }
        #next-btn:hover { background-color: #218838; }
        #restart-btn { background-color: #6c757d; color: white; }
        #restart-btn:hover { background-color: #5a6268; }
        #correct-btn { background-color: #f4b400; color: white; }
        #correct-btn:hover { background-color: #e3a500; }
        #result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        #result.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        #result.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        #description { margin-top: 15px; background: #e9ecef; padding: 15px; border-radius: 5px; border-left: 5px solid #007BFF; }
        #description-header { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }
        #completion-message { text-align: center; font-size: 2em; color: #28a745; margin-top: 50px; }
        #quiz-progress { text-align: right; font-size: 1em; color: #666; margin-bottom: 10px; }
        #quiz-tag { font-size: 0.9em; color: #888; margin-top: 10px; }
        /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        body.dark-mode { background-color: #181818; color: #e0e0e0; }
        body.dark-mode h1,
        body.dark-mode .question-title,
        body.dark-mode #quiz-progress,
        body.dark-mode #quiz-tag { color: #e0e0e0; }
        body.dark-mode .question-container { background: #232323; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        body.dark-mode .answer-options label { background: #333; color: #e0e0e0; }
        body.dark-mode .answer-options label:hover { background: #444; }
        body.dark-mode .answer-input { background: #222; color: #e0e0e0; border: 1px solid #444; }
        body.dark-mode #result.correct { background-color: #284d3d; color: #b6f7c1; border: 1px solid #3e7c5b; }
        body.dark-mode #result.incorrect { background-color: #5a2323; color: #ffd6d6; border: 1px solid #a14a4a; }
        body.dark-mode #description { background: #2c2c2c; border-left: 5px solid #f4b400; color: #e0e0e0; }
        body.dark-mode #completion-message { color: #b6f7c1; }
        body.dark-mode .button-group button { background-color: #333 !important; color: #e0e0e0 !important; }
        body.dark-mode #submit-btn { background-color: #0056b3 !important; }
        body.dark-mode #next-btn { background-color: #218838 !important; }
        body.dark-mode #restart-btn { background-color: #5a6268 !important; }
        body.dark-mode #correct-btn { background-color: #e3a500 !important; }
        /* í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #mode-toggle { position: fixed; top: 20px; right: 20px; z-index: 1000; padding: 8px 16px; border-radius: 20px; border: none; background: #eee; color: #333; cursor: pointer; font-size: 1em; }
        body.dark-mode #mode-toggle { background: #333; color: #e0e0e0; }
    </style>
</head>
<body>
    <button id="mode-toggle">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
    <h1>ë¬¸ì œ í•¨ ì–´ë•Œ</h1>
    <div id="question-area" class="question-container">
        <div id="quiz-progress"></div>
    </div>
    <div id="result"></div>
    <div id="completion-message" style="display:none;">
        <p>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ! ëª¨ë“  ë¬¸ì œë¥¼ í‘¸ì…¨ìŠµë‹ˆë‹¤.</p>
        <div id="quiz-summary"></div>
        <button id="restart-btn">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
    <script>
        // ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ í† ê¸€ ê¸°ëŠ¥
        const modeToggle = document.getElementById('mode-toggle');
        function setMode(mode) {
            if (mode === 'dark') {
                document.body.classList.add('dark-mode');
                modeToggle.textContent = 'â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ';
            } else {
                document.body.classList.remove('dark-mode');
                modeToggle.textContent = 'ğŸŒ™ ë‹¤í¬ëª¨ë“œ';
            }
            localStorage.setItem('quiz-mode', mode);
        }
        modeToggle.addEventListener('click', () => {
            const isDark = document.body.classList.contains('dark-mode');
            setMode(isDark ? 'light' : 'dark');
        });
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ëª¨ë“œ ì ìš©
        setMode(localStorage.getItem('quiz-mode') || 'light');

        document.addEventListener('DOMContentLoaded', () => {
            fetch('questions.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('questions.csv íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    return response.text();
                })
                .then(data => {
                    const questions = parseCSV(data);
                    
                    if (questions.length === 0) {
                        document.getElementById('question-area').innerHTML = '<p style="text-align:center; color:red;">íŒŒì¼ì— ìœ íš¨í•œ ë¬¸ì œê°€ ì—†ê±°ë‚˜, í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>';
                        return;
                    }

                    function shuffleArray(array) {
                        for (let i = array.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [array[i], array[j]] = [array[j], array[i]];
                        }
                    }

                    let correctAnswers = 0;
                    const totalQuestions = questions.length;
                    let currentQuestionIndex = 0;

                    function startQuiz() {
                        shuffleArray(questions);
                        correctAnswers = 0;
                        currentQuestionIndex = 0;
                        document.getElementById('result').style.display = 'block';
                        document.getElementById('question-area').style.display = 'block';
                        document.getElementById('completion-message').style.display = 'none';
                        displayQuestion(questions[currentQuestionIndex]);
                    }
                    
                    startQuiz();

                    function escapeHTML(text) {
                        const div = document.createElement('div');
                        div.textContent = text;
                        return div.innerHTML;
                    }

                    function displayQuestion(question) {
                        const qArea = document.getElementById('question-area');
                        qArea.innerHTML = '';
                        document.getElementById('result').innerHTML = '';

                        const progressDiv = document.createElement('div');
                        progressDiv.id = 'quiz-progress';
                        progressDiv.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${totalQuestions}`;
                        qArea.appendChild(progressDiv);

                        const title = document.createElement('h2');
                        title.className = 'question-title';
                        title.innerHTML = escapeHTML(question.title);
                        qArea.appendChild(title);

                        if (question.img && question.img.trim() !== 'ë³¸ì¸ì´ ì§ì ‘ ì •ë¦¬í•´ë³´ì„¸ìš”!!!') {
                            const imgPath = question.img.trim().substring(1);
                            const img = document.createElement('img');
                            img.className = 'question-img';
                            img.src = imgPath;
                            img.alt = 'ë¬¸ì œ ì´ë¯¸ì§€';
                            qArea.appendChild(img);
                        }

                        if (question.type === 'ê°ê´€ì‹') {
                            const optionsDiv = document.createElement('div');
                            optionsDiv.className = 'answer-options';
                            ['select1', 'select2', 'select3', 'select4'].forEach(key => {
                                if (question[key]) {
                                    const optionLabel = document.createElement('label');
                                    optionLabel.innerHTML = `<input type="radio" name="answer" value="${escapeHTML(question[key].trim())}"> ${escapeHTML(question[key].trim())}`;
                                    optionsDiv.appendChild(optionLabel);
                                }
                            });
                            qArea.appendChild(optionsDiv);
                        } else if (question.type === 'ì£¼ê´€ì‹') {
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.id = 'user-answer';
                            input.className = 'answer-input';
                            input.placeholder = 'ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”';
                            qArea.appendChild(input);
                        }

                        if (question.tag) {
                            const tagDiv = document.createElement('div');
                            tagDiv.id = 'quiz-tag';
                            tagDiv.textContent = `íƒœê·¸: ${question.tag.split(',').map(tag => tag.trim()).join(', ')}`;
                            qArea.appendChild(tagDiv);
                        }
                        
                        // ë²„íŠ¼ ì˜ì—­: ì™¼ìª½(ì œì¶œ/ë‹¤ìŒ), ì˜¤ë¥¸ìª½(ì •ë‹µ ì²˜ë¦¬)
                        const buttonGroup = document.createElement('div');
                        buttonGroup.className = 'button-group';

                        const leftButtons = document.createElement('div');
                        leftButtons.className = 'left-buttons button-row';

                        const rightButtons = document.createElement('div');
                        rightButtons.className = 'right-buttons button-row';
                        
                        const submitBtn = document.createElement('button');
                        submitBtn.id = 'submit-btn';
                        submitBtn.textContent = 'ì •ë‹µ í™•ì¸';
                        submitBtn.onclick = () => checkAnswer(question);
                        leftButtons.appendChild(submitBtn);

                        const nextBtn = document.createElement('button');
                        nextBtn.id = 'next-btn';
                        nextBtn.textContent = 'ë‹¤ìŒ ë¬¸ì œ';
                        nextBtn.style.display = 'none';
                        nextBtn.onclick = () => {
                            if (currentQuestionIndex < questions.length - 1) {
                                currentQuestionIndex++;
                                displayQuestion(questions[currentQuestionIndex]);
                            } else {
                                const quizSummary = document.getElementById('quiz-summary');
                                quizSummary.innerHTML = `
                                    <p>ì •ë‹µ: ${correctAnswers}ê°œ</p>
                                    <p>ì´ ë¬¸ì œ: ${totalQuestions}ê°œ</p>
                                `;
                                document.getElementById('question-area').style.display = 'none';
                                document.getElementById('result').style.display = 'none';
                                document.getElementById('completion-message').style.display = 'block';
                            }
                        };
                        leftButtons.appendChild(nextBtn);

                        const correctBtn = document.createElement('button');
                        correctBtn.id = 'correct-btn';
                        correctBtn.textContent = 'ì •ë‹µ ì²˜ë¦¬';
                        correctBtn.style.display = 'none';
                        correctBtn.onclick = () => {
                            correctAnswers++;
                            document.getElementById('result').className = 'correct';
                            document.getElementById('result').innerHTML = 'âœ… ì •ë‹µìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                            document.getElementById('correct-btn').style.display = 'none';
                            document.getElementById('next-btn').style.display = 'inline-block';
                        };
                        rightButtons.appendChild(correctBtn);

                        buttonGroup.appendChild(leftButtons);
                        buttonGroup.appendChild(rightButtons);
                        qArea.appendChild(buttonGroup);
                    }

                    function checkAnswer(question) {
                        const resultDiv = document.getElementById('result');
                        resultDiv.innerHTML = '';
                        resultDiv.className = '';
                        
                        let userAnswer = '';
                        if (question.type === 'ê°ê´€ì‹') {
                            const selectedOption = document.querySelector('input[name="answer"]:checked');
                            if (selectedOption) {
                                userAnswer = selectedOption.value.trim();
                                document.querySelectorAll('input[name="answer"]').forEach(input => {
                                    input.disabled = true;
                                });
                            }
                        } else if (question.type === 'ì£¼ê´€ì‹') {
                            const input = document.getElementById('user-answer');
                            userAnswer = input.value.trim();
                            input.disabled = true;
                        }
                        document.getElementById('submit-btn').style.display = 'none';

                        let correctAnswer = question.answer.trim();
                        if (correctAnswer.startsWith('"') && correctAnswer.endsWith('"')) {
                             correctAnswer = correctAnswer.slice(1, -1);
                        }
                        
                        const possibleAnswers = correctAnswer.split(',').map(ans => ans.trim().toLowerCase());

                        if (possibleAnswers.includes(userAnswer.toLowerCase())) {
                            resultDiv.className = 'correct';
                            resultDiv.innerHTML = 'âœ… ì •ë‹µì…ë‹ˆë‹¤!';
                            correctAnswers++;
                            document.getElementById('next-btn').style.display = 'inline-block';
                            document.getElementById('correct-btn').style.display = 'none';
                        } else {
                            resultDiv.className = 'incorrect';
                            resultDiv.innerHTML = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤!<br>ì •ë‹µ: ${escapeHTML(correctAnswer)}`;
                            // ì˜¤ë‹µì¸ ê²½ìš°: ì™¼ìª½ì— "ë‹¤ìŒ ë¬¸ì œ", ì˜¤ë¥¸ìª½ì— "ì •ë‹µ ì²˜ë¦¬"
                            document.getElementById('next-btn').style.display = 'inline-block';
                            document.getElementById('correct-btn').style.display = 'inline-block';
                        }

                        if (question.description) {
                            const descriptionDiv = document.createElement('div');
                            descriptionDiv.id = 'description';
                            descriptionDiv.innerHTML = `<span id="description-header">ì„¤ëª…</span><br>${escapeHTML(question.description).replace(/\\n/g, '<br>')}`;
                            resultDiv.appendChild(descriptionDiv);
                        }
                    }

                    function parseCSV(csvText) {
                        const lines = csvText.split('\r\n');
                        const headers = lines[0].split(',');
                        const data = [];
                        for (let i = 1; i < lines.length; i++) {
                            const currentLine = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                            if (currentLine.length === headers.length) {
                                const row = {};
                                for (let j = 0; j < headers.length; j++) {
                                    row[headers[j].trim()] = currentLine[j].trim().replace(/^"|"$/g, '');
                                }
                                data.push(row);
                            }
                        }
                        return data;
                    }

                    document.getElementById('restart-btn').addEventListener('click', () => {
                       startQuiz();
                    });
                })
                .catch(error => {
                    console.error('í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                    document.getElementById('question-area').innerHTML = `<p style="text-align:center; color:red;">í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼(questions.csv)ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€, ë˜ëŠ” ë‚´ìš©ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
                });
        });
    </script>
</body>
</html>